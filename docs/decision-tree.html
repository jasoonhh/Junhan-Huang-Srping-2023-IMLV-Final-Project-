<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Decision Tree | Credit Crad Default Prediction</title>
  <meta name="description" content="Chapter 4 Decision Tree | Credit Crad Default Prediction" />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Decision Tree | Credit Crad Default Prediction" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Decision Tree | Credit Crad Default Prediction" />
  
  
  

<meta name="author" content="Junhan Huang" />


<meta name="date" content="2023-05-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="logistic-regression.html"/>
<link rel="next" href="random-forest.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>




<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">CCDP</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Proposal</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#motivation"><i class="fa fa-check"></i><b>1.1</b> Motivation</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data"><i class="fa fa-check"></i><b>1.2</b> Data</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#models"><i class="fa fa-check"></i><b>1.3</b> Models</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#modeling-goal"><i class="fa fa-check"></i><b>1.4</b> Modeling Goal</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>2</b> Exploratory Data Analysis</a>
<ul>
<li class="chapter" data-level="2.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#the-structure-of-dataset"><i class="fa fa-check"></i><b>2.1</b> The Structure of Dataset</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#data-identification"><i class="fa fa-check"></i><b>2.1.1</b> Data Identification</a></li>
<li class="chapter" data-level="2.1.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#feature-problem-detection"><i class="fa fa-check"></i><b>2.1.2</b> Feature Problem Detection</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#data-visualization-analysis"><i class="fa fa-check"></i><b>2.2</b> Data Visualization &amp; Analysis</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#label-default-of-credit-card"><i class="fa fa-check"></i><b>2.2.1</b> Label: Default of credit card</a></li>
<li class="chapter" data-level="2.2.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#categorical-variable"><i class="fa fa-check"></i><b>2.2.2</b> Categorical Variable</a></li>
<li class="chapter" data-level="2.2.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#numerical-variable"><i class="fa fa-check"></i><b>2.2.3</b> Numerical Variable</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#eda-conclusion"><i class="fa fa-check"></i><b>2.3</b> EDA Conclusion</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#feature-selection"><i class="fa fa-check"></i><b>2.3.1</b> Feature Selection</a></li>
<li class="chapter" data-level="2.3.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#data-wrangling-and-spliting"><i class="fa fa-check"></i><b>2.3.2</b> Data Wrangling and Spliting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i><b>3</b> Logistic Regression</a>
<ul>
<li class="chapter" data-level="3.1" data-path="logistic-regression.html"><a href="logistic-regression.html#introduction"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="logistic-regression.html"><a href="logistic-regression.html#model-fitting"><i class="fa fa-check"></i><b>3.2</b> Model Fitting</a></li>
<li class="chapter" data-level="3.3" data-path="logistic-regression.html"><a href="logistic-regression.html#model-interpretation"><i class="fa fa-check"></i><b>3.3</b> Model Interpretation</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="logistic-regression.html"><a href="logistic-regression.html#model-information"><i class="fa fa-check"></i><b>3.3.1</b> Model Information</a></li>
<li class="chapter" data-level="3.3.2" data-path="logistic-regression.html"><a href="logistic-regression.html#shapley-values"><i class="fa fa-check"></i><b>3.3.2</b> Shapley Values</a></li>
<li class="chapter" data-level="3.3.3" data-path="logistic-regression.html"><a href="logistic-regression.html#partial-dependence-plots-pdp"><i class="fa fa-check"></i><b>3.3.3</b> Partial Dependence Plots (PDP)</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="logistic-regression.html"><a href="logistic-regression.html#model-evaluation"><i class="fa fa-check"></i><b>3.4</b> Model Evaluation</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="decision-tree.html"><a href="decision-tree.html"><i class="fa fa-check"></i><b>4</b> Decision Tree</a>
<ul>
<li class="chapter" data-level="4.1" data-path="decision-tree.html"><a href="decision-tree.html#introduction-1"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="decision-tree.html"><a href="decision-tree.html#model-fitting-1"><i class="fa fa-check"></i><b>4.2</b> Model Fitting</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="decision-tree.html"><a href="decision-tree.html#complexity-parameter-cp"><i class="fa fa-check"></i><b>4.2.1</b> Complexity Parameter (cp)</a></li>
<li class="chapter" data-level="4.2.2" data-path="decision-tree.html"><a href="decision-tree.html#decision-tree-1"><i class="fa fa-check"></i><b>4.2.2</b> Decision Tree</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="decision-tree.html"><a href="decision-tree.html#model-interpreation"><i class="fa fa-check"></i><b>4.3</b> Model Interpreation</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="decision-tree.html"><a href="decision-tree.html#shapley-values-1"><i class="fa fa-check"></i><b>4.3.1</b> Shapley Values</a></li>
<li class="chapter" data-level="4.3.2" data-path="decision-tree.html"><a href="decision-tree.html#partial-dependence-plots-pdp-1"><i class="fa fa-check"></i><b>4.3.2</b> Partial Dependence Plots (PDP)</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="decision-tree.html"><a href="decision-tree.html#model-evaluation-1"><i class="fa fa-check"></i><b>4.4</b> Model Evaluation</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="random-forest.html"><a href="random-forest.html"><i class="fa fa-check"></i><b>5</b> Random Forest</a>
<ul>
<li class="chapter" data-level="5.1" data-path="random-forest.html"><a href="random-forest.html#model-interpreation-1"><i class="fa fa-check"></i><b>5.1</b> Model Interpreation</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="random-forest.html"><a href="random-forest.html#shapley-values-2"><i class="fa fa-check"></i><b>5.1.1</b> Shapley Values</a></li>
<li class="chapter" data-level="5.1.2" data-path="random-forest.html"><a href="random-forest.html#partial-dependence-plots-pdp-2"><i class="fa fa-check"></i><b>5.1.2</b> Partial Dependence Plots (PDP)</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="random-forest.html"><a href="random-forest.html#model-evaluation-2"><i class="fa fa-check"></i><b>5.2</b> Model Evaluation</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="reflections.html"><a href="reflections.html"><i class="fa fa-check"></i><b>6</b> Reflections</a>
<ul>
<li class="chapter" data-level="6.1" data-path="reflections.html"><a href="reflections.html#model-comparison"><i class="fa fa-check"></i><b>6.1</b> Model Comparison</a></li>
<li class="chapter" data-level="6.2" data-path="reflections.html"><a href="reflections.html#main-takeaway"><i class="fa fa-check"></i><b>6.2</b> Main Takeaway</a></li>
<li class="chapter" data-level="6.3" data-path="reflections.html"><a href="reflections.html#limitaion"><i class="fa fa-check"></i><b>6.3</b> Limitaion</a></li>
<li class="chapter" data-level="6.4" data-path="reflections.html"><a href="reflections.html#future-work"><i class="fa fa-check"></i><b>6.4</b> Future Work</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Credit Crad Default Prediction</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="decision-tree" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Decision Tree<a href="decision-tree.html#decision-tree" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="introduction-1" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Introduction<a href="decision-tree.html#introduction-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Decision Tree is a non-parametric supervised model, which indicates that there is no particular assumptions about the kind of mapping function. we will use CART decision tree, which is a top-down greedy approach to find the partition minimizing the Gini Index, to predict whether or not a person will be a Credit Card defaulter.</p>
</div>
<div id="model-fitting-1" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Model Fitting<a href="decision-tree.html#model-fitting-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="complexity-parameter-cp" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Complexity Parameter (cp)<a href="decision-tree.html#complexity-parameter-cp" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><img src="finalproj_files/figure-html/unnamed-chunk-41-1.png" width="768" />
Complexity parameter is a regularization parameter that controls the tree size. Larger cp makes the tree simpler/smaller while smaller cp makes tree more complex.
The line chart cp versus cross-validated error rate roughly shows that cross-validated error rate will decrease initially and increase later when cp is increasing. The tree model attains lowest cross-validated error rate when cp = 0.00101.</p>
</div>
<div id="decision-tree-1" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Decision Tree<a href="decision-tree.html#decision-tree-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The left plot is the full decision tree model and the right is the pruned decision tree model.</p>
<p><img src="finalproj_files/figure-html/unnamed-chunk-42-1.png" width="768" /></p>
<p>Given the two plot above, we can find that the pruning with cp = 0.00101 can significantly reduce the decision tree model complexity (From depth 28 to depth 3). As the full decision tree is too complex to read and interpret, we would pay more attention on the pruned tree model. In each node of the the pruned tree model, we can find the major label of the data in the node which is on the top of the node, the gini index which represent the measure of impurity and is at the middle of the node, and the percentage which represents the proportion of training instances that belong to each class at that node and is at the bottom of node. The conditioanl statement in the middle of branch is the criteria of splitting.</p>
</div>
</div>
<div id="model-interpreation" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Model Interpreation<a href="decision-tree.html#model-interpreation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="shapley-values-1" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Shapley Values<a href="decision-tree.html#shapley-values-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><img src="finalproj_files/figure-html/unnamed-chunk-43-1.png" width="768" />
The Shapley value is the average contribution of a feature value to the prediction in different coalitions. The plot above shows the mean absolute SHAP values of the decision tree model we built, which represent the each variable’s impact to prediction.
Both of the full tree model and pruned tree model have same feature importance distribution and the most importance feature is <code>PAY_1</code> and the second is <code>BILL_AMT1</code>.
However, by comparing the magnitude of mean absolute shap value between the full tree model and pruned tree model, we can find the pruned decision tree model treat the <code>PAY_1</code> more important than full decision tree.</p>
</div>
<div id="partial-dependence-plots-pdp-1" class="section level3 hasAnchor" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Partial Dependence Plots (PDP)<a href="decision-tree.html#partial-dependence-plots-pdp-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="partial-dependence-plots-of-variable-pay_1-1" class="section level4 hasAnchor" number="4.3.2.1">
<h4><span class="header-section-number">4.3.2.1</span> Partial Dependence Plots of variable <code>PAY_1</code><a href="decision-tree.html#partial-dependence-plots-of-variable-pay_1-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><img src="finalproj_files/figure-html/unnamed-chunk-44-1.png" width="768" />
From the Partial Dependence Plot of PAY_1 from the full tree model and the pruned tree model, we can see that the pruning model’s distribution of level contribution of PAY_1 is less volatile than that of the full model. This information suggests that clients who have a history of less delay in their payments (lower PAY_1 level) are less likely to default on their credit card payments. The cut off of the level impact toward prediction at <code>PAY_1</code> = 2 matches both models partition criteria at <code>PAY_1</code>.</p>
<p>However, there is a paradoxical phenomenon where the full decision tree model’s contribution distribution of PAY_1 levels is completely opposite to the logistic regression model’s contribution distribution of PAY_1 levels. This phenomenon could be explained by the exploratory data analysis of PAY_1, where the frequency distribution of PAY_1 levels among default clients is similar to the full decision tree model’s distribution of level contribution of PAY_1.</p>
</div>
<div id="partial-dependence-plots-of-variable-bill_amt1" class="section level4 hasAnchor" number="4.3.2.2">
<h4><span class="header-section-number">4.3.2.2</span> Partial Dependence Plots of variable <code>BILL_AMT1</code><a href="decision-tree.html#partial-dependence-plots-of-variable-bill_amt1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><img src="finalproj_files/figure-html/unnamed-chunk-45-1.png" width="768" />
Similar to the <code>PAY_1</code> variable, the distribution of level contribution of <code>BILL_AMT1</code> in the pruned model is less volatile than that of the full model. In the partial dependence plot for <code>BILL_AMT1</code> from the full model, we can observe that the contribution falls in a fluctuating manner as the bill statement amount from the previous month increases.</p>
</div>
</div>
</div>
<div id="model-evaluation-1" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Model Evaluation<a href="decision-tree.html#model-evaluation-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><img src="finalproj_files/figure-html/unnamed-chunk-46-1.png" width="768" /></p>
<pre><code>## Accuracy of Full Model:  0.6995</code></pre>
<pre><code>## Accuracy of Pruned Model:  0.8235</code></pre>
<p>The two plots above represent the Receiver Operating Characteristic (ROC) curves of the full model and the pruned model. The red line vertical to the X-axis represents the optimal threshold evaluated by the Youden index. The Area Under the Curve (AUC), which measures the area under the ROC curve, is a metric used to evaluate the performance of a binary classification model. Given the AUC of the full model is 0.7176, the AUC of the pruned model is 0.642, and the full model achieves the same level of TPR as the pruned model with a lower FPR, we can conclude that the full tree model is better if we focus on predicting true default clients (sensitivity). However, we can barely interpret the information given from the visualization of the full model, which can be seen as a trade-off between interpretability and model performance.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="logistic-regression.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="random-forest.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jasoonhh/Junhan-Huang-Srping-2023-IMLV-Final-Project-/edit/main/model2.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/jasoonhh/Junhan-Huang-Srping-2023-IMLV-Final-Project-/blob/main/model2.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
